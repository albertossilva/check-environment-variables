version: "0.3"
kind: container

dev_branch: "origin/dev"
runtime: nodejs8

name: api
group: cart

api:
  path_part: /{proxy+}
  http_methods:
    - ANY
  authorization: NONE
  private: true

env:
  START_EXPRESS:     true
  DATABASE_NAME:     "parameter::/gsp/cart/database/name"
  DATABASE_USER:     "parameter::/gsp/cart/database/user"
  DATABASE_PASSWORD: "parameter::/gsp/cart/database/password"
  DATABASE_HOST:     "parameter::/gsp/cart/database/host"
  AWS_REGION:        "us-east-1"
  CART_TOPIC_ARN:    "parameter::/gsp/cart/summarization-listener/bus/listener/cart/topic_arn"
  LOG_NAMESPACES:    "*,-http"
  CART_API_KEY: "5bd16316-df58-4121-a155-8eea6537351c"
  API_HOST: "http://apigw-proxy.dev.naturacloud.com:8000/globalsales"
  REQUEST_TIMEOUT: 15000

database:
  engine: postgres
  migration_command: npm run db:migrate && npm run db:seed

tests:
  test_command: 'npm run db:migrate && npm run db:seed && npm run test'
  common_env:
    DATABASE_HOST:     localhost
    DATABASE_NAME:     cart_development
    DATABASE_PASSWORD: postgres
    DATABASE_PORT:     5432
    DATABASE_USER:     postgres
    NODE_ENV:          development
    NODE_PATH:         "src:test"
    START_EXPRESS:     "1"
  dependencies:
    - name: database
      image: postgres:10.5-alpine
      env:
        POSTGRES_DB: cart_development
        POSTGRES_PASSWORD: postgres
